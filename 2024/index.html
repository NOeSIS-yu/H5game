<!DOCTYPE html>
<html>
  <head>
    <title>2048å°æ¸¸æˆ</title>
    <meta charset="utf-8" />
    <style media="screen">
      #game {
        display: none;
        position: absolute;
        left: 0px;
        top: 0px;
        right: 0px;
        bottom: 0px;
        background-color: #c3ae9d;
        opacity: 0.5;
        z-index: 1;
      }

      .clear:after {
        content: "";
        display: table;
        clear: both;
      }

      .left {
        float: left;
      }

      .right {
        float: right;
      }

      .scoreShow {
        height: 50px;
        text-align: center;
        line-height: 50px;
      }

      .model {
        text-decoration: none;
        color: white;
        background-color: #bbada0;
        font-size: 36px;
        border-radius: 10px;
      }

      .head {
        width: 480px;
        height: 50px;
        margin: 0 auto;
        font-size: 25px;
      }

      #gridPanel {
        width: 480px;
        height: 480px;
        margin: 0 auto;
        background-color: #bbada0;
        border-radius: 10px;
        position: relative;
        z-index: 1;
      }

      .grid,
      .cell {
        width: 100px;
        height: 100px;
        border-radius: 6px;
      }

      .grid {
        background-color: #ccc0b3;
        float: left;
        margin: 16px 0 0 16px;
      }

      .cell {
        position: absolute;
        font-size: 60px;
        text-align: center;
        line-height: 100px;
        color: #fff;
      }

      .n2 {
        background-color: #eee3da;
      }

      .n4 {
        background-color: #ede0c8;
      }

      .n8 {
        background-color: #f2b179;
      }

      .n16 {
        background-color: #f59563;
      }

      .n32 {
        background-color: #f67c5f;
      }

      .n64 {
        background-color: #f65e3b;
      }

      .n128 {
        background-color: #edcf72;
      }

      .n256 {
        background-color: #edcc61;
      }

      .n512 {
        background-color: #9c0;
      }

      .n1024 {
        background-color: #33b5e5;
      }

      .n2048 {
        background-color: #09c;
      }

      .n4096 {
        background-color: #a6c;
      }

      .n8192 {
        background-color: #93c;
      }

      .n2,
      .n4 {
        color: #776e65;
      }

      #gameover {
        width: 100%;
        display: none;
        position: fixed;
        left: 50%;
        right: 50%;
        top: 148px;
        width: 220px;
        height: 200px;
        border-radius: 10px;
        background-color: white;
        margin-left: -110px;
        text-align: center;
        z-index: 5;
      }

      #gameover > a {
        display: inline-block;
        width: 170px;
        height: 50px;
        border-radius: 10px;
        text-decoration: none;
        background-color: #9f8d77;
        color: white;
        font-size: 36px;
      }
    </style>
  </head>

  <body>
    <div id="game"></div>
    <div class="head clear">
      <div class="scoreShow left">
        <span>Score:</span>
        <span id="score"></span>
      </div>
      <div class="selction right" onclick="getModel(event)">
        <a href="#" class="model" value="3">3X3</a>
        <a href="#" class="model" value="4">4X4</a>
        <a href="#" class="model" type="button">5X5</a>
        <a href="#" class="model" type="button">6X6</a>
        <!-- <input type="text" id="model"> -->
        <!-- <button type="button" name="button" id="set">è®¾ç½®æ¸¸æˆ</button> -->
      </div>
    </div>
    <div id="gridPanel"></div>
    <div id="gameover">
      <h1 id="Score"></h1>
      <a href="#" id="again" onclick="obj.gameStart()">Try again</a>
    </div>
    <script type="text/javascript">
      var arr = [];

      function $(id) {
        return document.getElementById(id);
      }

      function C(cls) {
        return document.getElementsByClassName(cls);
      }
      var obj = {
        ROW: 4,
        CELL: 4,
        r: 0,
        c: 0,
        f: 0, //rè¡Œ  cåˆ—  fæŸ¥æ‰¾çš„ä¸‹ä¸€ä½ç½®
        keyCd: 0,
        score: 0,
        createEle: 0, //æ˜¯å¦éœ€è¦åˆ›å»ºå…ƒç´ 
        eleFragment: "", //æ–‡æ¡£ç‰‡æ®µå˜é‡
        //æ¸¸æˆå¼€å§‹
        gameStart: function () {
          obj.init();
          document.onkeydown = function (e) {
            //è‡ªåŠ¨è·å¾—äº‹ä»¶å¯¹è±¡
            switch (
              e.keyCode //åˆ¤æ–­æŒ‰é”®å·
            ) {
              case 37:
                obj.keyCd = 1;
                obj.moveLeft();
                break;
              case 38:
                obj.keyCd = 2;
                obj.moveUp();
                break;
              case 39:
                obj.keyCd = 1;
                obj.moveRight();
                break;
              case 40:
                obj.keyCd = 2;
                obj.moveDown();
                break;
            }
            $("score").innerHTML = obj.score; //æ›´æ–°åˆ†æ•°
          };
        },

        //åˆå§‹åŒ–
        init: function () {
          obj.eleFragment = document.createDocumentFragment();
          for (r = 0; r < obj.ROW; r++) {
            arr.push([]);
            for (c = 0; c < obj.CELL; c++) {
              arr[r][c] = 0;
              if (obj.createEle == 1) {
                obj.create(r, c);
              }
            }
          }
          if (obj.createEle == 1) {
            obj.createEle = 0;
            $("gridPanel").innerHTML = ""; //æ¸…ç©ºåŸæœ‰çš„å…ƒç´ 
            $("gridPanel").appendChild(obj.eleFragment); //æ·»åŠ å…ƒç´ 
          }
          obj.score = 0;
          $("score").innerHTML = obj.score;
          $("game").style.display = "none";
          $("gameover").style.display = "none";
          obj.random(); //å¼€å§‹æ¸¸æˆéšæœºç”Ÿæˆä¸¤ä¸ªæ•°
          obj.random();
          obj.updateView();
        },
        //åˆ›å»ºdivå…ƒç´ ï¼Œæ·»åŠ åˆ°gridPanelä¸­
        create: function (r, c) {
          var grid, cell;
          var increment = 14,
            grWidth,
            grHeight,
            grMarginTop,
            grMarginLeft,
            ceWidth,
            ceHight;
          grid = document.createElement("div");
          cell = document.createElement("div");
          grid.id = "g" + r + c;
          grid.className = "grid";
          cell.id = "c" + r + c;
          cell.className = "cell";

          if (obj.ROW == 3) {
            increment = 24;
          } else if (obj.ROW == 4) {
            increment = 18;
          }
          grWidth =
            grHeight =
            ceWidth =
            ceHight =
              66 + (6 - obj.ROW) * increment; //ä¼˜åŒ–å
          grMarginTop = grMarginLeft =
            (480 - grWidth * obj.ROW) / (obj.ROW + 1);
          grid.style.width = grWidth + "px";
          grid.style.height = grHeight + "px";
          grid.style.marginTop = grMarginTop + "px";
          grid.style.marginLeft = grMarginLeft + "px";
          cell.style.width = ceWidth + "px";
          cell.style.height = ceHight + "px";
          cell.style.top = grMarginTop + r * (grMarginTop + ceWidth) + "px";
          cell.style.left = grMarginLeft + c * (grMarginLeft + ceHight) + "px";
          cell.style.lineHeight = ceHight + "px";
          cell.style.fontSize = 30 + (6 - obj.ROW) * 10 + "px";
          //ä¼˜åŒ–å‰
          /*if (obj.ROW == 3) {
          grid.style.width = "140px";
          grid.style.height = "140px";
          grid.style.margin = "15px 0 0 15px";
          cell.style.width = "140px";
          cell.style.height = "140px";
          cell.style.top = 15 + r * 155 + "px"; //è®¾ç½®è·ç¦»ä¸Šä¸€ä½ç½®çš„é«˜åº¦
          cell.style.left = 15 + c * 155 + "px"; //è®¾ç½®ç¦»å·¦ä¸€ä½ç½®çš„è·ç¦»
          cell.style.lineHeight = "140px";
        } else if (obj.ROW == 4) {
          grid.style.width = "100px";
          grid.style.height = "100px";
          grid.style.margin = "16px 0 0 16px";
          cell.style.width = "100px";
          cell.style.height = "100px";
          cell.style.top = 16 + r * 116 + "px";
          cell.style.left = 16 + c * 116 + "px";
          cell.style.lineHeight = "100px";
        } else if (obj.ROW == 5) {
          grid.style.width = "75px";
          grid.style.height = "75px";
          grid.style.margin = "17.5px 0 0 17.5px";
          cell.style.width = "75px";
          cell.style.height = "75px";
          cell.style.top = 17.5 + r * 92.5 + "px";
          cell.style.left = 17.5 + c * 92.5 + "px";
          cell.style.fontSize = "40px";
          cell.style.lineHeight = "75px";
        } else if (obj.ROW == 6) {
          grid.style.width = "66px";
          grid.style.height = "66px";
          grid.style.margin = "12px 0 0 12px";
          cell.style.width = "66px";
          cell.style.height = "66px";
          cell.style.top = 12 + r * 78 + "px";
          cell.style.left = 12 + c * 78 + "px";
          cell.style.fontSize = "30px";
          cell.style.lineHeight = "66px";
        }*/
          obj.eleFragment.appendChild(grid);
          obj.eleFragment.appendChild(cell);
        },
        //éšæœºäº§ç”Ÿä¸€ä¸ªæ–°çš„æ•°
        random: function () {
          while (1) {
            var row = Math.floor(Math.random() * obj.ROW);
            var cell = Math.floor(Math.random() * obj.CELL);
            if (arr[row][cell] == 0) {
              //åˆ¤æ–­ç”Ÿæˆçš„éšæœºæ•°ä½ç½®ä¸º0æ‰éšæœºç”Ÿæˆ2æˆ–4
              arr[row][cell] = Math.random() > 0.5 ? 4 : 2;
              break;
            }
          }
          // var row = Math.floor(Math.random() * 4);
          // var cell = Math.floor(Math.random() * 4);
          // if (arr[row][cell] == 0) { //åˆ¤æ–­ç”Ÿæˆçš„éšæœºæ•°ä½ç½®ä¸º0æ‰éšæœºç”Ÿæˆ2æˆ–4
          //   arr[row][cell] = (Math.random() > 0.5) ? 4 : 2;
          //   return;
          // }
          // obj.random();//é€’å½’å½±å“æ‰§è¡Œæ•ˆç‡
        },
        //æ›´æ–°é¡µé¢
        updateView: function () {
          var win = 0;
          for (r = 0; r < obj.ROW; r++) {
            for (c = 0; c < obj.CELL; c++) {
              if (arr[r][c] == 0) {
                //å€¼ä¸º0çš„ä¸æ˜¾ç¤º
                $("c" + r + c).innerHTML = ""; //0ä¸æ˜¾ç¤º
                $("c" + r + c).className = "cell"; //æ¸…é™¤æ ·å¼
              } else {
                $("c" + r + c).innerHTML = arr[r][c];
                $("c" + r + c).className = "cell n" + arr[r][c]; //æ·»åŠ ä¸åŒæ•°å­—çš„é¢œè‰²
                if (obj.ROW == 3 && arr[r][c] == 1024) {
                  win = 1;
                } else if (obj.ROW == 4 && arr[r][c] == 2048) {
                  win = 1;
                } else if (obj.ROW == 5 && arr[r][c] == 4096) {
                  win = 1;
                } else if (obj.ROW == 6 && arr[r][c] == 8192) {
                  win = 1;
                }
              }
            }
          }
          if (win == 1) {
            //é€šå…³
            $("game").style.display = "block";
            $("gameover").style.display = "block";
            $("Score").innerHTML = "You win!<br>Score:" + obj.score;
          }
          if (obj.isGameOver()) {
            //æ¸¸æˆå¤±è´¥
            $("game").style.display = "block";
            $("gameover").style.display = "block";
            $("Score").innerHTML = "GAME OVER!<br>Score:" + obj.score;
            console.log("gameover");
          }
        },
        //æ¸¸æˆå¤±è´¥
        isGameOver: function () {
          for (r = 0; r < obj.ROW; r++) {
            for (c = 0; c < obj.CELL; c++) {
              if (arr[r][c] == 0) {
                //æœ‰0è¿˜ä¸æ˜¯gameover
                return false;
              } else if (c != obj.CELL - 1 && arr[r][c] == arr[r][c + 1]) {
                //å·¦å¾€å³  å‰ä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªä¸ç›¸ç­‰
                return false;
              } else if (r != obj.ROW - 1 && arr[r][c] == arr[r + 1][c]) {
                //ä¸Šå¾€ä¸‹ ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ªä¸ç›¸ç­‰
                return false;
              }
            }
          }
          return true;
        },
        //æŸ¥æ‰¾ä¸‹ä¸€ä¸ªä¸ä¸º0çš„æ•°å€¼çš„ä½ç½®
        find: function (r, c, start, condition, direction) {
          if (obj.keyCd == 2) {
            //ä¸Šä¸‹æŒ‰é”®
            if (direction == 1) {
              //å‘ä¸ŠæŒ‰é”®  f++
              for (var f = start; f < condition; f += direction) {
                if (arr[f][c] != 0) {
                  return f;
                }
              }
            } else {
              //å‘ä¸‹æŒ‰é”® f--
              for (var f = start; f >= condition; f += direction) {
                if (arr[f][c] != 0) {
                  return f;
                }
              }
            }
          } else {
            //å·¦å³æŒ‰é”®
            if (direction == 1) {
              //å·¦æŒ‰é”®   f++
              for (var f = start; f < condition; f += direction) {
                if (arr[r][f] != 0) {
                  return f;
                }
              }
            } else {
              //å³æŒ‰é”®  f--
              for (var f = start; f >= condition; f += direction) {
                if (arr[r][f] != 0) {
                  return f;
                }
              }
            }
          }
          return null; //å¾ªç¯ç»“æŸä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼=0çš„æ•°å€¼ï¼Œè¿”å›null
        },
        //å·¦æŒ‰é”®çš„å¤„ç†
        dealToLeft: function (r) {
          var next;
          for (c = 0; c < obj.ROW; c++) {
            next = obj.find(r, c, c + 1, obj.CELL, 1); //æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸ä¸º0çš„ä½ç½®
            if (next == null) break; //æ²¡æœ‰æ‰¾åˆ°å°±è¿”å›
            //å¦‚æœå½“å‰ä½ç½®ä¸º0
            if (arr[r][c] == 0) {
              arr[r][c] = arr[r][next]; //æŠŠæ‰¾åˆ°çš„ä¸ä¸º0çš„æ•°å€¼æ›¿æ¢ä¸ºå½“å‰ä½ç½®çš„å€¼
              arr[r][next] = 0; //æ‰¾åˆ°çš„ä½ç½®æ¸…0
              c--; //å†æ¬¡å¾ªç¯å¤šä¸€æ¬¡ï¼ŒæŸ¥çœ‹åé¢å¦æœ‰å€¼ä¸æ›¿æ¢åçš„å€¼ç›¸åŒï¼Œ
            } else if (arr[r][c] == arr[r][next]) {
              //å¦‚æœå½“å‰ä½ç½®ä¸æ‰¾åˆ°çš„ä½ç½®æ•°å€¼ç›¸ç­‰ï¼Œåˆ™ç›¸åŠ 
              arr[r][c] *= 2;
              arr[r][next] = 0;
              obj.score += arr[r][c];
            }
          }
        },
        move: function (itertor) {
          var before, //æ²¡å¤„ç†å‰
            after; //afterå¤„ç†å
          before = arr.toString();
          itertor(); //æ‰§è¡Œforå‡½æ•°
          after = arr.toString();
          if (before != after) {
            //å‰åå¯¹æ¯”ï¼Œå¦‚æœä¸åŒå°±update
            obj.random();
            obj.updateView();
          }
        },
        moveLeft: function () {
          obj.move(function () {
            for (r = 0; r < obj.ROW; r++) {
              obj.dealToLeft(r);
            }
          });
          // if å½“å‰ä½ç½® ä¸ä¸ºé›¶
          // ä»å½“å‰ä½ç½®ï¼Œä¸‹ä¸€ä¸ªæˆå‘˜å¼€å§‹ï¼Œéå†ï¼Œ
          // å¦‚æœæ‰¾åˆ°ï¼Œä¸å½“å‰ä½ç½®ç›¸ç­‰çš„æ•°ï¼Œ
          // ä¸¤è€…ç›¸åŠ ï¼Œå¹¶æŠŠä¸ä¸ºé›¶çš„æˆå‘˜ï¼Œè®¾ç½®ä¸ºé›¶
          // å¦‚æœ å½“å‰ä½ç½®æ˜¯ é›¶
          // ä»å½“å‰ä½ç½®ä¸‹ä¸€ä¸ªæˆå‘˜å¼€å§‹éå†
          // å¦‚æœæ‰¾åˆ° ç¬¬ä¸€ä¸ªä¸ä¸ºé›¶çš„æˆå‘˜
          // å½“å‰ä½ç½®æ•°å€¼è®¾ç½®ä¸ºè¿™ä¸ªä¸ä¸ºé›¶çš„æˆå‘˜çš„å€¼ ï¼Œå¹¶ä¸”æŠŠé‚£ä¸ªä¸ä¸ºé›¶çš„æˆå‘˜è®¾ç½®ä¸º 0
        },
        //å³æŒ‰é”®å¤„ç†
        dealToRight: function (r) {
          var next;
          for (c = obj.CELL - 1; c >= 0; c--) {
            next = obj.find(r, c, c - 1, 0, -1); //æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸ä¸º0çš„ä½ç½®
            if (next == null) break; //æ²¡æœ‰æ‰¾åˆ°å°±è¿”å›
            //å¦‚æœå½“å‰ä½ç½®ä¸º0
            if (arr[r][c] == 0) {
              arr[r][c] = arr[r][next]; //æŠŠæ‰¾åˆ°çš„ä¸ä¸º0çš„æ•°å€¼æ›¿æ¢ä¸ºå½“å‰ä½ç½®çš„å€¼
              arr[r][next] = 0; //æ‰¾åˆ°çš„ä½ç½®æ¸…0
              c++; //å†æ¬¡å¾ªç¯å¤šä¸€æ¬¡ï¼ŒæŸ¥çœ‹åé¢å¦æœ‰å€¼ä¸æ›¿æ¢åçš„å€¼ç›¸åŒï¼Œ
            } else if (arr[r][c] == arr[r][next]) {
              //å¦‚æœå½“å‰ä½ç½®ä¸æ‰¾åˆ°çš„ä½ç½®æ•°å€¼ç›¸ç­‰ï¼Œåˆ™ç›¸åŠ 
              arr[r][c] *= 2;
              arr[r][next] = 0;
              obj.score += arr[r][c];
            }
          }
        },
        moveRight: function () {
          obj.move(function () {
            for (r = 0; r < obj.ROW; r++) {
              obj.dealToRight(r);
            }
          });
        },
        //ä¸ŠæŒ‰é”®å¤„ç†
        dealToUp: function (c) {
          var next;
          for (r = 0; r < obj.ROW; r++) {
            next = obj.find(r, c, r + 1, obj.ROW, 1); //æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸ä¸º0çš„ä½ç½®
            if (next == null) break;
            //å¦‚æœå½“å‰ä½ç½®ä¸º0
            if (arr[r][c] == 0) {
              arr[r][c] = arr[next][c]; //æŠŠæ‰¾åˆ°çš„ä¸ä¸º0çš„æ•°å€¼æ›¿æ¢ä¸ºå½“å‰ä½ç½®çš„å€¼
              arr[next][c] = 0; //æ‰¾åˆ°çš„ä½ç½®æ¸…0
              r--; //å†æ¬¡å¾ªç¯å¤šä¸€æ¬¡ï¼ŒæŸ¥çœ‹åé¢å¦æœ‰å€¼ä¸æ›¿æ¢åçš„å€¼ç›¸åŒ
            } else if (arr[r][c] == arr[next][c]) {
              //å¦‚æœå½“å‰ä½ç½®ä¸æ‰¾åˆ°çš„ä½ç½®æ•°å€¼ç›¸ç­‰ï¼Œåˆ™ç›¸åŠ 
              arr[r][c] *= 2;
              arr[next][c] = 0;
              obj.score += arr[r][c];
            }
          }
        },
        moveUp: function () {
          obj.move(function () {
            for (c = 0; c < obj.CELL; c++) {
              obj.dealToUp(c);
            }
          });
        },
        //ä¸‹æŒ‰é”®å¤„ç†
        dealToDown: function (c) {
          var next;
          for (r = obj.ROW - 1; r >= 0; r--) {
            next = obj.find(r, c, r - 1, 0, -1); //æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸ä¸º0çš„ä½ç½®
            if (next == null) {
              break;
            }
            //å¦‚æœå½“å‰ä½ç½®ä¸º0
            if (arr[r][c] == 0) {
              arr[r][c] = arr[next][c]; //æŠŠæ‰¾åˆ°çš„ä¸ä¸º0çš„æ•°å€¼æ›¿æ¢ä¸ºå½“å‰ä½ç½®çš„å€¼
              arr[next][c] = 0; //æ‰¾åˆ°çš„ä½ç½®æ¸…0
              r++; //å†æ¬¡å¾ªç¯å¤šä¸€æ¬¡ï¼ŒæŸ¥çœ‹åé¢å¦æœ‰å€¼ä¸æ›¿æ¢åçš„å€¼ç›¸åŒ
            } else if (arr[r][c] == arr[next][c]) {
              //å¦‚æœå½“å‰ä½ç½®ä¸æ‰¾åˆ°çš„ä½ç½®æ•°å€¼ç›¸ç­‰ï¼Œåˆ™ç›¸åŠ 
              arr[r][c] *= 2;
              arr[next][c] = 0;
              obj.score += arr[r][c];
            }
          }
        },
        moveDown: function () {
          obj.move(function () {
            for (c = 0; c < obj.CELL; c++) {
              obj.dealToDown(c);
            }
          });
        },
      };
      window.onload = function () {
        obj.createEle = 1;
        obj.gameStart();
      };
      //åˆ‡æ¢æ¨¡å¼
      function getModel(e) {
        //äº‹ä»¶å†’æ³¡è·å–aå…ƒç´ 
        var a = e.target,
          modelValue = 4;
        if (a.nodeName == "A") {
          if (a.innerHTML == "3X3") {
            modelValue = 3;
          } else if (a.innerHTML == "4X4") {
            modelValue = 4;
          } else if (a.innerHTML == "5X5") {
            modelValue = 5;
          } else if (a.innerHTML == "6X6") {
            modelValue = 6;
          }
          obj.ROW = obj.CELL = modelValue;
          obj.createEle = 1; //éœ€è¦åˆ›å»ºæ ¼å­divå…ƒç´ çš„æ ‡å¿—
          obj.gameStart();
        }
      }

      //   var modelValue = parseInt($("model").value);
      //   if (isNaN(modelValue)) {
      //     modelValue = 4; //é»˜è®¤æ˜¯4*4
      //   }
      //   if (modelValue <= 2 || modelValue > 6) return; //2æ ¼æˆ–è€…å¤§äº6æ ¼æ— æ•ˆ
      //   obj.ROW = modelValue;
      //   obj.CELL = modelValue;
      //   obj.createEle = 1;
      //   obj.gameStart();
      //   console.log(modelValue);
      // }
      window.onload = function () {
        alert("ä½¿ç”¨é”®ç›˜çš„æ–¹å‘é”®æ§åˆ¶ç§»åŠ¨ğŸ¥±");
      };
    </script>
  </body>
</html>
